<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>truck-code: include/can/can.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">truck-code
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_806ab3c8068dd71592b990dab5bd95a8.html">can</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">can.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="common_8h_source.html">utils/common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="j1939__struct_8h_source.html">jbus/j1939_struct.h</a>&quot;</code><br />
<code>#include &lt;string&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for can.h:</div>
<div class="dyncontent">
<div class="center"><img src="can_8h__incl.png" border="0" usemap="#include_2can_2can_8h" alt=""/></div>
<map name="include_2can_2can_8h" id="include_2can_2can_8h">
<area shape="rect" id="node2" href="common_8h.html" title="utils/common.h" alt="" coords="39,229,150,256"/>
<area shape="rect" id="node5" href="j1939__struct_8h.html" title="jbus/j1939_struct.h" alt="" coords="231,80,363,107"/>
<area shape="rect" id="node7" href="j1939__utils_8h.html" title="j1939_utils.h" alt="" coords="183,155,278,181"/>
<area shape="rect" id="node10" href="timestamp_8h.html" title="utils/timestamp.h" alt="" coords="303,155,425,181"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="can_8h__dep__incl.png" border="0" usemap="#include_2can_2can_8hdep" alt=""/></div>
<map name="include_2can_2can_8hdep" id="include_2can_2can_8hdep">
<area shape="rect" id="node2" href="can_8cpp.html" title="include/can/can.cpp" alt="" coords="5,80,144,107"/>
<area shape="rect" id="node3" href="jbus_8cpp.html" title="include/jbus/jbus.cpp" alt="" coords="168,80,312,107"/>
<area shape="rect" id="node4" href="can__man_8cpp.html" title="src/can_man.cpp" alt="" coords="336,80,459,107"/>
</map>
</div>
</div>
<p><a href="can_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5ec367b5ae68929b7516c68b6ee8d152"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="can_8h.html#a5ec367b5ae68929b7516c68b6ee8d152">can_init</a> (int argc, char *argv[], resmgr_connect_funcs_t *pconn, resmgr_io_funcs_t *pio, IOFUNC_ATTR_T *pattr)</td></tr>
<tr class="separator:a5ec367b5ae68929b7516c68b6ee8d152"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f3488fd7d51e2711caeae9a8e90821f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="can_8h.html#a2f3488fd7d51e2711caeae9a8e90821f">can_set_filter</a> (int fd, unsigned long id, unsigned long mask)</td></tr>
<tr class="separator:a2f3488fd7d51e2711caeae9a8e90821f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3807ddfc0a7ed992d6578b7cdae1812"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="can_8h.html#ab3807ddfc0a7ed992d6578b7cdae1812">can_empty_queue</a> (int fd)</td></tr>
<tr class="separator:ab3807ddfc0a7ed992d6578b7cdae1812"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a525e8830c9044004537b1874310ac528"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="can_8h.html#a525e8830c9044004537b1874310ac528">can_arm</a> (int fd, int channel_id)</td></tr>
<tr class="separator:a525e8830c9044004537b1874310ac528"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5896f83efd15e19b8b38e2ff688c7b1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="can_8h.html#ac5896f83efd15e19b8b38e2ff688c7b1">can_read</a> (intptr_t fd, unsigned long *id, char *extended, void *data, <a class="el" href="common_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> size)</td></tr>
<tr class="separator:ac5896f83efd15e19b8b38e2ff688c7b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf4723c769b649a27e06677f9c94bd2d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="can_8h.html#acf4723c769b649a27e06677f9c94bd2d">can_write</a> (intptr_t fd, unsigned long id, char extended, void *data, <a class="el" href="common_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> size)</td></tr>
<tr class="separator:acf4723c769b649a27e06677f9c94bd2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73ae80c9c1c9a95cbc65b51310db5aa1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="can_8h.html#a73ae80c9c1c9a95cbc65b51310db5aa1">can_send</a> (int fd, <a class="el" href="structj1939__pdu__typ.html">j1939_pdu_typ</a> *pdu)</td></tr>
<tr class="separator:a73ae80c9c1c9a95cbc65b51310db5aa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="can_8h.html">can.h</a></p>
<p>This file contains utility methods needed to read and write messages to the Control Area Network (CAN) card.</p>
<dl class="section author"><dt>Author</dt><dd>Abdul Rahman Kreidieh </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>January 14, 2019 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a525e8830c9044004537b1874310ac528"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a525e8830c9044004537b1874310ac528">&#9670;&nbsp;</a></span>can_arm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int can_arm </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>channel_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enable pulses from the CAN driver to the client process.</p>
<p>Pulses are waited for with MsgReceive or IP_Receive. Internal to the driver, done as part of open for read.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>file descriptor for the location of the CAN card </td></tr>
    <tr><td class="paramname">channel_id</td><td>The ID of the channel that can be used to receive messages and pulses </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EOK - Success.<br />
 EAGAIN - The devctl() command couldn't be completed because the device driver was in use by another process, or the driver was unable to carry out the request due to an outstanding command in progress.<br />
 EBADF - Invalid open file descriptor, filedes.<br />
 EINTR - The devctl() function was interrupted by a signal.<br />
 EINVAL - The device driver detected an error in dev_data_ptr or n_bytes.<br />
 EIO - The devctl() function couldn't complete because of a hardware error.<br />
 ENOSYS - The device doesn't support the dcmd command.<br />
 ENOTTY - The dcmd argument isn't a valid command for this device.<br />
 EPERM - The process doesn't have sufficient permission to carry out the requested command. </dd></dl>

</div>
</div>
<a id="ab3807ddfc0a7ed992d6578b7cdae1812"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3807ddfc0a7ed992d6578b7cdae1812">&#9670;&nbsp;</a></span>can_empty_queue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int can_empty_queue </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Empty the queue of messages in the CAN driver.</p>
<p>This is internal to the driver, and done as part of open for read</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>file descriptor for the location of the CAN card </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of messages that were dropped from the queue </dd></dl>

</div>
</div>
<a id="a5ec367b5ae68929b7516c68b6ee8d152"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ec367b5ae68929b7516c68b6ee8d152">&#9670;&nbsp;</a></span>can_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void can_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">resmgr_connect_funcs_t *&#160;</td>
          <td class="paramname"><em>pconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">resmgr_io_funcs_t *&#160;</td>
          <td class="paramname"><em>pio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IOFUNC_ATTR_T *&#160;</td>
          <td class="paramname"><em>pattr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the CAN driver.</p>
<p>This function is called from the main() during the initialization of the CAN driver to read the .ini file and initialize the can_info structure, and initialize the function tables.</p>
<p>Additional Arguments:</p>
<ul>
<li>-e: specifies extended frame</li>
<li>-f: specifies whether to create a copy of pconfig (not modify the original)</li>
<li>-i: interrupt request line</li>
<li>-n: device name</li>
<li>-p: port</li>
<li>-s: bit speed</li>
<li>-v: verbose</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>see additional arguments </td></tr>
    <tr><td class="paramname">argv</td><td>see additional arguments </td></tr>
    <tr><td class="paramname">pconn</td><td>table of the POSIX-level connect functions that are used by a resource manager. The open handle is updated to support opening the CAN card port </td></tr>
    <tr><td class="paramname">pio</td><td>table of the POSIX-level I/O functions that are used by a resource manager. The devctl handle is updated to support interrupt handling on the CAN card port </td></tr>
    <tr><td class="paramname">pattr</td><td>pointer to information per device manager </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac5896f83efd15e19b8b38e2ff688c7b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5896f83efd15e19b8b38e2ff688c7b1">&#9670;&nbsp;</a></span>can_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int can_read </td>
          <td>(</td>
          <td class="paramtype">intptr_t&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>extended</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="common_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read information from the CAN card.</p>
<p>This message will update the ID, message format, and data field of a CAN message.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>file descriptor for the location of the CAN card </td></tr>
    <tr><td class="paramname">id</td><td>CAN message format ID </td></tr>
    <tr><td class="paramname">extended</td><td>updated to be 1 if the identifier is in extended (29 bit) format, 0 if it is in the unextended (11 bit) format </td></tr>
    <tr><td class="paramname">data</td><td>the content of the data field. This element will be modified by this method. </td></tr>
    <tr><td class="paramname">size</td><td>number of bytes in the CAN data field </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of bytes in the data segment; -1 if error encountered </dd></dl>

</div>
</div>
<a id="a73ae80c9c1c9a95cbc65b51310db5aa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73ae80c9c1c9a95cbc65b51310db5aa1">&#9670;&nbsp;</a></span>can_send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int can_send </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structj1939__pdu__typ.html">j1939_pdu_typ</a> *&#160;</td>
          <td class="paramname"><em>pdu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>FIXME (merge with can_write)</p>
<p>PATH CAN driver does not yet use state code or slot arguments, provided for compatibility with B&amp;B STB converter send routine.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>file descriptor that is used when sending the message </td></tr>
    <tr><td class="paramname">pdu</td><td>message to send </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on error, 1 on success. </dd></dl>

</div>
</div>
<a id="a2f3488fd7d51e2711caeae9a8e90821f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f3488fd7d51e2711caeae9a8e90821f">&#9670;&nbsp;</a></span>can_set_filter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int can_set_filter </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set the CAN filter.</p>
<p>Internal to the driver, set as part of open for read</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>file descriptor for the location of the CAN card </td></tr>
    <tr><td class="paramname">id</td><td>CAN message format ID (standard or extended) </td></tr>
    <tr><td class="paramname">mask</td><td>requested filter mask </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EOK - Success.<br />
 EAGAIN - The devctl() command couldn't be completed because the device driver was in use by another process, or the driver was unable to carry out the request due to an outstanding command in progress.<br />
 EBADF - Invalid open file descriptor, filedes.<br />
 EINTR - The devctl() function was interrupted by a signal.<br />
 EINVAL - The device driver detected an error in dev_data_ptr or n_bytes.<br />
 EIO - The devctl() function couldn't complete because of a hardware error.<br />
 ENOSYS - The device doesn't support the dcmd command.<br />
 ENOTTY - The dcmd argument isn't a valid command for this device.<br />
 EPERM - The process doesn't have sufficient permission to carry out the requested command. </dd></dl>

</div>
</div>
<a id="acf4723c769b649a27e06677f9c94bd2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf4723c769b649a27e06677f9c94bd2d">&#9670;&nbsp;</a></span>can_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int can_write </td>
          <td>(</td>
          <td class="paramtype">intptr_t&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>extended</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="common_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write information to the CAN card.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>file descriptor for the location of the CAN card </td></tr>
    <tr><td class="paramname">id</td><td>CAN device id on bus </td></tr>
    <tr><td class="paramname">extended</td><td>0 for standard (11 bit) format, 1 for extended (29 bit) format </td></tr>
    <tr><td class="paramname">data</td><td>the content of the data field </td></tr>
    <tr><td class="paramname">size</td><td>number of bytes to be added to the data field </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EOK - Success.<br />
 EAGAIN - The devctl() command couldn't be completed because the device driver was in use by another process, or the driver was unable to carry out the request due to an outstanding command in progress.<br />
 EBADF - Invalid open file descriptor, filedes.<br />
 EINTR - The devctl() function was interrupted by a signal.<br />
 EINVAL - The device driver detected an error in dev_data_ptr or n_bytes.<br />
 EIO - The devctl() function couldn't complete because of a hardware error.<br />
 ENOSYS - The device doesn't support the dcmd command.<br />
 ENOTTY - The dcmd argument isn't a valid command for this device.<br />
 EPERM - The process doesn't have sufficient permission to carry out the requested command.<br />
</dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
